import{p as k,u as z,i as r,c as g,m as G,a as o,g as w,t as c,d as t,k as $,v as I,h as x,e as H,w as J,r as O,F as Q,n as W,q as X,l as Y,o as n}from"./index-DrWYcUKa.js";import{p as V}from"./posts-COGdu68B.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const y={getList(l){return k.get(`/comments/post/${l}`)},create(l){return k.post("/comments",l)},update(l,m){return k.put(`/comments/${l}`,m)},delete(l){return k.delete(`/comments/${l}`)}},tt={class:"post-detail"},et={key:0,class:"loading"},st={key:1,class:"error"},ot={key:2},nt={class:"post-header"},at={class:"post-meta"},ct={class:"post-content"},lt={key:0,class:"post-actions"},it={class:"comments-section"},rt={key:0,class:"comment-form"},dt=["disabled"],ut={key:1,class:"login-required"},mt={class:"comments-list"},vt={class:"comment-header"},_t={class:"comment-date"},pt={key:0,class:"comment-edit"},ht={class:"comment-edit-actions"},bt=["onClick"],kt={key:1},yt={class:"comment-content"},Ct={key:0,class:"comment-actions"},ft=["onClick"],gt=["onClick"],wt={__name:"PostDetail",setup(l){const m=Y(),v=X(),A=z(),i=r(null),C=r([]),d=r(""),_=r(null),u=r(""),f=r(!1),p=r(""),B=g(()=>A.isAuthenticated),D=g(()=>A.currentUser),L=g(()=>{var e,s;return((e=i.value)==null?void 0:e.user_id)===((s=D.value)==null?void 0:s.id)}),N=e=>{var s;return e.user_id===((s=D.value)==null?void 0:s.id)},S=async()=>{f.value=!0,p.value="";try{const e=await V.getDetail(v.params.id);i.value=e.data}catch{p.value="게시글을 불러오는데 실패했습니다."}finally{f.value=!1}},h=async()=>{try{const e=await y.getList(v.params.id);C.value=e.data.comments}catch(e){console.error("Failed to fetch comments:",e)}},U=async()=>{if(d.value.trim())try{await y.create({postId:parseInt(v.params.id),content:d.value}),d.value="",h()}catch{alert("댓글 작성에 실패했습니다.")}},E=e=>{_.value=e.id,u.value=e.content},F=()=>{_.value=null,u.value=""},R=async e=>{try{await y.update(e,{content:u.value}),_.value=null,u.value="",h()}catch{alert("댓글 수정에 실패했습니다.")}},T=async e=>{if(confirm("댓글을 삭제하시겠습니까?"))try{await y.delete(e),h()}catch{alert("댓글 삭제에 실패했습니다.")}},q=()=>{m.push(`/posts/${v.params.id}/edit`)},M=async()=>{if(confirm("게시글을 삭제하시겠습니까?"))try{await V.delete(v.params.id),m.push("/posts")}catch{alert("게시글 삭제에 실패했습니다.")}},K=()=>{m.push("/posts")},P=e=>new Date(e).toLocaleString("ko-KR");return G(()=>{S(),h()}),(e,s)=>{const j=O("router-link");return n(),o("div",tt,[f.value?(n(),o("div",et,"로딩 중...")):p.value?(n(),o("div",st,c(p.value),1)):i.value?(n(),o("div",ot,[t("div",nt,[t("h2",null,c(i.value.title),1),t("div",at,[t("span",null,"작성자: "+c(i.value.username),1),t("span",null,"조회수: "+c(i.value.view_count),1),t("span",null,c(P(i.value.created_at)),1)])]),t("div",ct,c(i.value.content),1),L.value?(n(),o("div",lt,[t("button",{onClick:q,class:"btn btn-edit"},"수정"),t("button",{onClick:M,class:"btn btn-delete"},"삭제")])):w("",!0),t("div",it,[t("h3",null,"댓글 ("+c(C.value.length)+")",1),B.value?(n(),o("div",rt,[$(t("textarea",{"onUpdate:modelValue":s[0]||(s[0]=a=>d.value=a),placeholder:"댓글을 입력하세요",rows:"3"},null,512),[[I,d.value]]),t("button",{onClick:U,class:"btn btn-primary",disabled:!d.value.trim()}," 댓글 작성 ",8,dt)])):(n(),o("div",ut,[s[3]||(s[3]=x(" 댓글을 작성하려면 ",-1)),H(j,{to:"/login"},{default:J(()=>[...s[2]||(s[2]=[x("로그인",-1)])]),_:1}),s[4]||(s[4]=x("하세요. ",-1))])),t("div",mt,[(n(!0),o(Q,null,W(C.value,a=>(n(),o("div",{key:a.id,class:"comment"},[t("div",vt,[t("strong",null,c(a.username),1),t("span",_t,c(P(a.created_at)),1)]),_.value===a.id?(n(),o("div",pt,[$(t("textarea",{"onUpdate:modelValue":s[1]||(s[1]=b=>u.value=b),rows:"2"},null,512),[[I,u.value]]),t("div",ht,[t("button",{onClick:b=>R(a.id),class:"btn btn-sm"},"저장",8,bt),t("button",{onClick:F,class:"btn btn-sm btn-cancel"},"취소")])])):(n(),o("div",kt,[t("p",yt,c(a.content),1),N(a)?(n(),o("div",Ct,[t("button",{onClick:b=>E(a),class:"btn-text"},"수정",8,ft),t("button",{onClick:b=>T(a.id),class:"btn-text"},"삭제",8,gt)])):w("",!0)]))]))),128))])]),t("div",{class:"back-btn"},[t("button",{onClick:K,class:"btn btn-secondary"},"목록으로")])])):w("",!0)])}}},Pt=Z(wt,[["__scopeId","data-v-c9f7b337"]]);export{Pt as default};
