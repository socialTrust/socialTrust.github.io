import{p as K,u as j,i,c as C,m as z,a as o,g as f,t as l,d as t,k as P,v as D,h as g,e as G,w as H,r as J,F as O,n as Q,q as W,l as X,o as n}from"./index-CyP352op.js";import{p as I}from"./posts-BcBLrDNj.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const h=K,Z={class:"post-detail"},tt={key:0,class:"loading"},et={key:1,class:"error"},st={key:2},ot={class:"post-header"},nt={class:"post-meta"},at={class:"post-content"},lt={key:0,class:"post-actions"},ct={class:"comments-section"},it={key:0,class:"comment-form"},rt=["disabled"],dt={key:1,class:"login-required"},ut={class:"comments-list"},mt={class:"comment-header"},vt={class:"comment-date"},_t={key:0,class:"comment-edit"},pt={class:"comment-edit-actions"},ht=["onClick"],kt={key:1},bt={class:"comment-content"},yt={key:0,class:"comment-actions"},Ct=["onClick"],ft=["onClick"],gt={__name:"PostDetail",setup(wt){const k=X(),u=W(),w=j(),c=i(null),b=i([]),r=i(""),m=i(null),d=i(""),y=i(!1),v=i(""),V=C(()=>w.isAuthenticated),x=C(()=>w.currentUser),B=C(()=>{var e,s;return((e=c.value)==null?void 0:e.user_id)===((s=x.value)==null?void 0:s.id)}),N=e=>{var s;return e.user_id===((s=x.value)==null?void 0:s.id)},S=async()=>{y.value=!0,v.value="";try{const e=await I.getDetail(u.params.id);c.value=e.data}catch{v.value="게시글을 불러오는데 실패했습니다."}finally{y.value=!1}},_=async()=>{try{const e=await h.getList(u.params.id);b.value=e.data.comments}catch(e){console.error("Failed to fetch comments:",e)}},U=async()=>{if(r.value.trim())try{await h.create({postId:parseInt(u.params.id),content:r.value}),r.value="",_()}catch{alert("댓글 작성에 실패했습니다.")}},$=e=>{m.value=e.id,d.value=e.content},E=()=>{m.value=null,d.value=""},F=async e=>{try{await h.update(e,{content:d.value}),m.value=null,d.value="",_()}catch{alert("댓글 수정에 실패했습니다.")}},L=async e=>{if(confirm("댓글을 삭제하시겠습니까?"))try{await h.delete(e),_()}catch{alert("댓글 삭제에 실패했습니다.")}},R=()=>{k.push(`/posts/${u.params.id}/edit`)},T=async()=>{if(confirm("게시글을 삭제하시겠습니까?"))try{await I.delete(u.params.id),k.push("/posts")}catch{alert("게시글 삭제에 실패했습니다.")}},q=()=>{k.push("/posts")},A=e=>new Date(e).toLocaleString("ko-KR");return z(()=>{S(),_()}),(e,s)=>{const M=J("router-link");return n(),o("div",Z,[y.value?(n(),o("div",tt,"로딩 중...")):v.value?(n(),o("div",et,l(v.value),1)):c.value?(n(),o("div",st,[t("div",ot,[t("h2",null,l(c.value.title),1),t("div",nt,[t("span",null,"작성자: "+l(c.value.username),1),t("span",null,"조회수: "+l(c.value.view_count),1),t("span",null,l(A(c.value.created_at)),1)])]),t("div",at,l(c.value.content),1),B.value?(n(),o("div",lt,[t("button",{onClick:R,class:"btn btn-edit"},"수정"),t("button",{onClick:T,class:"btn btn-delete"},"삭제")])):f("",!0),t("div",ct,[t("h3",null,"댓글 ("+l(b.value.length)+")",1),V.value?(n(),o("div",it,[P(t("textarea",{"onUpdate:modelValue":s[0]||(s[0]=a=>r.value=a),placeholder:"댓글을 입력하세요",rows:"3"},null,512),[[D,r.value]]),t("button",{onClick:U,class:"btn btn-primary",disabled:!r.value.trim()}," 댓글 작성 ",8,rt)])):(n(),o("div",dt,[s[3]||(s[3]=g(" 댓글을 작성하려면 ",-1)),G(M,{to:"/login"},{default:H(()=>[...s[2]||(s[2]=[g("로그인",-1)])]),_:1}),s[4]||(s[4]=g("하세요. ",-1))])),t("div",ut,[(n(!0),o(O,null,Q(b.value,a=>(n(),o("div",{key:a.id,class:"comment"},[t("div",mt,[t("strong",null,l(a.username),1),t("span",vt,l(A(a.created_at)),1)]),m.value===a.id?(n(),o("div",_t,[P(t("textarea",{"onUpdate:modelValue":s[1]||(s[1]=p=>d.value=p),rows:"2"},null,512),[[D,d.value]]),t("div",pt,[t("button",{onClick:p=>F(a.id),class:"btn btn-sm"},"저장",8,ht),t("button",{onClick:E,class:"btn btn-sm btn-cancel"},"취소")])])):(n(),o("div",kt,[t("p",bt,l(a.content),1),N(a)?(n(),o("div",yt,[t("button",{onClick:p=>$(a),class:"btn-text"},"수정",8,Ct),t("button",{onClick:p=>L(a.id),class:"btn-text"},"삭제",8,ft)])):f("",!0)]))]))),128))])]),t("div",{class:"back-btn"},[t("button",{onClick:q,class:"btn btn-secondary"},"목록으로")])])):f("",!0)])}}},Dt=Y(gt,[["__scopeId","data-v-c9f7b337"]]);export{Dt as default};
