import{p as K,u as j,i,c as g,m as z,a as o,g as w,t as c,d as e,k as D,v as V,h as P,e as G,w as H,r as J,F as O,n as Q,q as W,l as X,o as n}from"./index-CxMTdPvu.js";import{u as Y}from"./posts-DEk91uF9.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const b=K,tt={class:"post-detail"},et={key:0,class:"loading"},st={key:1,class:"error"},ot={key:2},nt={class:"post-header"},at={class:"post-meta"},ct={class:"post-content"},lt={key:0,class:"post-actions"},it={class:"comments-section"},rt={key:0,class:"comment-form"},dt=["disabled"],ut={key:1,class:"login-required"},mt={class:"comments-list"},vt={class:"comment-header"},_t={class:"comment-date"},pt={key:0,class:"comment-edit"},ht={class:"comment-edit-actions"},bt=["onClick"],kt={key:1},yt={class:"comment-content"},Ct={key:0,class:"comment-actions"},ft=["onClick"],gt=["onClick"],wt={__name:"PostDetail",setup(Pt){const k=X(),u=W(),x=j(),m=Y(),l=i(null),y=i([]),r=i(""),v=i(null),d=i(""),C=i(!1),_=i(""),B=g(()=>x.isAuthenticated),I=g(()=>x.currentUser),S=g(()=>{var t,s;return((t=l.value)==null?void 0:t.user_id)===((s=I.value)==null?void 0:s.id)}),$=t=>{var s;return t.user_id===((s=I.value)==null?void 0:s.id)},N=async()=>{C.value=!0,_.value="";try{const t=u.params.id,s=m.getPostById(t);s&&(l.value=s,console.log(`✨ 캐시된 게시글 사용 - ID ${t}`));const f=await m.fetchPostById(t);l.value=f,m.incrementViewCount(t)}catch(t){_.value="게시글을 불러오는데 실패했습니다.",console.error("게시글 로딩 실패:",t)}finally{C.value=!1}},p=async()=>{try{const t=await b.getList(u.params.id);y.value=t.data.comments}catch(t){console.error("댓글 로딩 실패:",t)}},U=async()=>{if(r.value.trim())try{await b.create({postId:parseInt(u.params.id),content:r.value}),r.value="",p()}catch{alert("댓글 작성에 실패했습니다.")}},E=t=>{v.value=t.id,d.value=t.content},L=()=>{v.value=null,d.value=""},R=async t=>{try{await b.update(t,{content:d.value}),v.value=null,d.value="",p()}catch{alert("댓글 수정에 실패했습니다.")}},T=async t=>{if(confirm("댓글을 삭제하시겠습니까?"))try{await b.delete(t),p()}catch{alert("댓글 삭제에 실패했습니다.")}},q=()=>{k.push(`/posts/${u.params.id}/edit`)},F=async()=>{if(confirm("게시글을 삭제하시겠습니까?"))try{await m.deletePost(u.params.id),k.push("/posts")}catch{alert("게시글 삭제에 실패했습니다.")}},M=()=>{k.push("/posts")},A=t=>new Date(t).toLocaleString("ko-KR");return z(()=>{N(),p()}),(t,s)=>{const f=J("router-link");return n(),o("div",tt,[C.value?(n(),o("div",et,"로딩 중...")):_.value?(n(),o("div",st,c(_.value),1)):l.value?(n(),o("div",ot,[e("div",nt,[e("h2",null,c(l.value.title),1),e("div",at,[e("span",null,"작성자: "+c(l.value.username),1),e("span",null,"조회수: "+c(l.value.view_count),1),e("span",null,c(A(l.value.created_at)),1)])]),e("div",ct,c(l.value.content),1),S.value?(n(),o("div",lt,[e("button",{onClick:q,class:"btn btn-edit"},"수정"),e("button",{onClick:F,class:"btn btn-delete"},"삭제")])):w("",!0),e("div",it,[e("h3",null,"댓글 ("+c(y.value.length)+")",1),B.value?(n(),o("div",rt,[D(e("textarea",{"onUpdate:modelValue":s[0]||(s[0]=a=>r.value=a),placeholder:"댓글을 입력하세요",rows:"3"},null,512),[[V,r.value]]),e("button",{onClick:U,class:"btn btn-primary",disabled:!r.value.trim()}," 댓글 작성 ",8,dt)])):(n(),o("div",ut,[s[3]||(s[3]=P(" 댓글을 작성하려면 ",-1)),G(f,{to:"/login"},{default:H(()=>[...s[2]||(s[2]=[P("로그인",-1)])]),_:1}),s[4]||(s[4]=P("하세요. ",-1))])),e("div",mt,[(n(!0),o(O,null,Q(y.value,a=>(n(),o("div",{key:a.id,class:"comment"},[e("div",vt,[e("strong",null,c(a.username),1),e("span",_t,c(A(a.created_at)),1)]),v.value===a.id?(n(),o("div",pt,[D(e("textarea",{"onUpdate:modelValue":s[1]||(s[1]=h=>d.value=h),rows:"2"},null,512),[[V,d.value]]),e("div",ht,[e("button",{onClick:h=>R(a.id),class:"btn btn-sm"},"저장",8,bt),e("button",{onClick:L,class:"btn btn-sm btn-cancel"},"취소")])])):(n(),o("div",kt,[e("p",yt,c(a.content),1),$(a)?(n(),o("div",Ct,[e("button",{onClick:h=>E(a),class:"btn-text"},"수정",8,ft),e("button",{onClick:h=>T(a.id),class:"btn-text"},"삭제",8,gt)])):w("",!0)]))]))),128))])]),e("div",{class:"back-btn"},[e("button",{onClick:M,class:"btn btn-secondary"},"목록으로")])])):w("",!0)])}}},Dt=Z(wt,[["__scopeId","data-v-cbb55e30"]]);export{Dt as default};
