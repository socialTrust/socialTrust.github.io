import{x as y,y as w,i as d,c as g}from"./index-CxMTdPvu.js";const h=y,x=w("posts",()=>{const s=d(new Map),r=d(new Map),n=d(new Map),l=d(!1),c=d(null),f=g(()=>e=>s.value.get(String(e))),P=g(()=>e=>r.value.get(`page:${e}`)),C=g(()=>(e,t)=>n.value.get(`search:${e}:${t}`));return{loading:l,error:c,getPostById:f,getListByPage:P,getSearchResults:C,fetchPosts:async(e=1,t=10,a=!1)=>{const o=`page:${e}`;if(!a&&r.value.has(o))return console.log(`[Cache Hit] Post list page ${e}`),r.value.get(o);l.value=!0,c.value=null;try{console.log(`[Cache Miss] Fetching post list page ${e}`);const i=(await h.getList(e,t)).data;return r.value.set(o,i),i.posts.forEach(v=>{s.value.set(String(v.id),v)}),i}catch(u){throw c.value=u.message||"Failed to fetch posts",u}finally{l.value=!1}},fetchPostById:async(e,t=!1)=>{const a=String(e);if(!t&&s.value.has(a))return console.log(`[Cache Hit] Post ${a}`),s.value.get(a);l.value=!0,c.value=null;try{console.log(`[Cache Miss] Fetching post ${a}`);const u=(await h.getDetail(e)).data;return s.value.set(a,u),u}catch(o){throw c.value=o.message||"Failed to fetch post",o}finally{l.value=!1}},searchPosts:async(e,t=1,a=10,o=!1)=>{const u=`search:${e}:${t}`;if(!o&&n.value.has(u))return console.log(`[Cache Hit] Search "${e}" page ${t}`),n.value.get(u);l.value=!0,c.value=null;try{console.log(`[Cache Miss] Searching "${e}" page ${t}`);const v=(await h.search(e,t,a)).data;return n.value.set(u,v),v.posts.forEach(p=>{s.value.set(String(p.id),p)}),v}catch(i){throw c.value=i.message||"Failed to search posts",i}finally{l.value=!1}},createPost:async e=>{l.value=!0,c.value=null;try{const a=(await h.create(e)).data;return r.value.clear(),n.value.clear(),s.value.set(String(a.id),a),console.log("[Cache Invalidated] Post created, list cache cleared"),a}catch(t){throw c.value=t.message||"Failed to create post",t}finally{l.value=!1}},updatePost:async(e,t)=>{l.value=!0,c.value=null;try{const o=(await h.update(e,t)).data;return s.value.set(String(e),o),r.value.clear(),n.value.clear(),console.log(`[Cache Updated] Post ${e} updated, list cache cleared`),o}catch(a){throw c.value=a.message||"Failed to update post",a}finally{l.value=!1}},deletePost:async e=>{l.value=!0,c.value=null;try{await h.delete(e),s.value.delete(String(e)),r.value.clear(),n.value.clear(),console.log(`[Cache Invalidated] Post ${e} deleted, all caches cleared`)}catch(t){throw c.value=t.message||"Failed to delete post",t}finally{l.value=!1}},incrementViewCount:e=>{const t=String(e),a=s.value.get(t);a&&(a.views=(a.views||0)+1,s.value.set(t,{...a}))},clearAllCache:()=>{s.value.clear(),r.value.clear(),n.value.clear(),console.log("[Cache Cleared] All caches cleared")},getCacheStats:()=>({postsCount:s.value.size,listPagesCount:r.value.size,searchResultsCount:n.value.size,totalCachedItems:s.value.size+r.value.size+n.value.size})}});export{x as u};
